# Дипломный проект «Поисковая система»

Проект разработан в **Visual Studio 2022** с использованием стандарта **C++20** и  разбит на модули для удобства тестирования и поддержки.

## Структура проекта

```text
FinalDiplom/
├── Source/                 # Исходный код
│   ├── DatabaseManager/        # Подключение к PostgreSQL, создание таблиц, сохранение данных, поиск по словам
│   ├── Indexer/                # Преобразует HTML в чистый текст, разбивает на слова, считает частоту
│   ├── IniFile/                # Читает и парсит INI-файлы (config.ini)
│   ├── LinkExtractor/          # Находит все <a href="..."> в HTML и возвращает список URL
│   ├── SpiderClient/           # Выполняет HTTP/HTTPS-запросы, возвращает HTML-контент
│   ├── SpiderEngine/           # Координирует работу: берёт URL → скачивает → извлекает ссылки → индексирует → сохраняет в БД
│   ├── spider/                 # Основной исполняемый проект "Паук" (Main.cpp, config.ini)
│   ├── search_server/          # HTTP-сервер поиска (Main.cpp, config.ini)
│   └── Source.sln              # Файл решения Visual Studio (группирует все проекты)
└── Distributiv/            # Готовый дистрибутив для запуска (exe + dll + config.ini)
```

## Установка зависимостей

### 1. Установка vcpkg

Установите `vcpkg` в папку `C:\Tools\`:

```powershell
cd C:\
git clone https://github.com/microsoft/vcpkg.git Tools\vcpkg
cd Tools\vcpkg
.\bootstrap-vcpkg.bat
```

### 2. Интеграция с Visual Studio

```powershell
.\vcpkg integrate install
```
Это позволит Visual Studio автоматически находить заголовки и библиотеки без ручной настройки путей.

### 3. Установка необходимых библиотек

Выполните в папке C:\Tools\vcpkg:
```powershell
.\vcpkg install boost-asio:x64-windows boost-beast:x64-windows boost-locale:x64-windows libpqxx:x64-windows openssl:x64-windows
```
Эти команды установят:

- **Boost.Asio** и **Boost.Beast** — для сетевых операций и HTTPS,  
- **Boost.Locale** — для корректной обработки текста (включая UTF-8 и кириллицу),  
- **libpqxx** — для взаимодействия с PostgreSQL,  
- **OpenSSL** — обеспечивает поддержку шифрования SSL/TLS, необходимую для безопасного HTTPS-соединения и работы с защищёнными базами данных.

## Настройка базы данных

### 1. Установка PostgreSQL

Скачайте и установите PostgreSQL с официального сайта:  
https://www.postgresql.org/download/windows/

Убедитесь, что служба PostgreSQL запущена.

### 2. Создание пользователя и базы данных

Откройте **SQL Shell (psql)** или **pgAdmin** и выполните следующие команды:

```sql
-- Создаём пользователя
CREATE USER spider_user WITH PASSWORD 'ваш_пароль';

-- Создаём базу данных
CREATE DATABASE spider_db OWNER spider_user;

-- Даём права на схему public
GRANT ALL ON SCHEMA public TO spider_user;
```

Таблицы будут созданы после первого запуска **spider.exe**.

### 3. Проверка подключения

Файл конфигурации `config.ini` содержит параметры для запуска компонентов дипломного проекта: веб-паука и HTTP-сервера поиска. 
Должен находиться в той же папке, что и исполняемые файлы (`spider.exe`, `search_server.exe`).

```ini
[Spider]                                 
StartUrl = https://www.rudgormash.ru/    
MaxDepth = 2                             

[Server]
Port=8080

[Database]
Host = localhost
Port = 5432
Name = spider_db
User = spider_user
Password = ваш_пароль
```

| Параметр   | Тип                | Описание |
|------------|--------------------|----------|
| `StartUrl` | строка             | URL-адрес начальной страницы, с которой начинается рекурсивный обход |
| `MaxDepth` | целое число ≥ 0    | Максимальная глубина рекурсии при обходе сайта <br>• `0` — только начальная страница,<br>• `1` — начальная + все ссылки с неё,<br>• `2` — начальная → ссылки → ссылки со ссылок.<br>Рекомендуемое значение: `2` |
| `Port`   | целое число (1024–65535) | Номер TCP-порта, на котором запускается сервер поиска (по умолчанию — `8080`) |
| `Host`     | строка | Адрес сервера БД (`localhost`, IP-адрес или доменное имя) |
| `Port`     | целое число | Порт PostgreSQL (обычно `5432`) |
| `Name`     | строка | Имя базы данных (например, `spider_db`) |
| `User`     | строка | Имя пользователя СУБД с правами доступа к базе данных |
| `Password` | строка | Пароль пользователя |

Теперь проект готов к сборке и запуску

## Сборка дипломного проекта «Поисковая система»

1. Откройте решение `Source/Source.sln` в **Visual Studio 2022**.  
2. Выберите конфигурацию: **Release → x64**.  
3. Выполните: **Сборка → Пересобрать решение**.

После успешной сборки всех проектов автоматически запустится скрипт `deploy.bat`, который:
- соберёт все исполняемые файлы (`spider.exe`, `search_server.exe`),
- скопирует необходимые DLL-библиотеки,
- поместит файл конфигурации `config.ini`,
- и сформирует готовый к запуску дистрибутив.

Готовые файлы появятся в папке `Distributiv/`.

> ⚠️ Все настройки компиляции (стандарт **C++20**, флаг `/utf-8`, пути к заголовкам и библиотекам) уже сохранены в файлах проекта (`.vcxproj`) и применяются автоматически — дополнительная настройка не требуется. 


## Запуск приложений

### 1. Запуск «Паука» (индексация сайта)

1. Перейдите в папку `Distributiv/`.
2. Запустите:
   ```bat
   spider.exe 
3. Программа начнёт рекурсивный обход сайта, указанного в `config.ini`, и сохранит данные в PostgreSQL. После завершения (глубина исчерпана или достигнут лимит) программа завершится.

---

### 2. Запуск HTTP-сервера поиска

1. Перейдите в папку `Distributiv/`.
2. Запустите:
   ```bat
   search_server.exe
3. Сервер запустится и начнёт слушать указанный порт (по умолчанию — `8080`).  
Откройте в браузере:  
[http://localhost:8080](http://localhost:8080)  

4. Введите поисковый запрос (до 4 слов, каждое не короче 3 символов) и получите результаты.

> ⚠️ **Важно**: убедитесь, что PostgreSQL запущен и содержит проиндексированные данные. Для этого сначала выполните `spider.exe`, а затем — `search_server.exe`.